<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AccordeON - –ì–∏—Ç–∞—Ä–∞üé∏</title>

    <style>
        * {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .song {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            background: #f9f9f9;
        }
        pre {
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0 15px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        #status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
<h1>üé∏ AccordeON - –¢–≤–æ–π –≥–∏—Ç–∞—Ä–Ω—ã–π –ø–µ—Å–µ–Ω–Ω–∏–∫</h1>

<div id="status"></div>

<h2>–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Å–Ω—é</h2>
<input id="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ó–≤–µ–∑–¥–∞ –ø–æ –∏–º–µ–Ω–∏ –°–æ–ª–Ω—Ü–µ)">
<input id="artist" placeholder="–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ö–∏–Ω–æ)">
<textarea id="lyrics" placeholder="–¢–µ–∫—Å—Ç –ø–µ—Å–Ω–∏" rows="4"></textarea>
<textarea id="chords" placeholder="–ê–∫–∫–æ—Ä–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: Am C Dm E)" rows="2"></textarea>
<button onclick="addSong()">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Å–Ω—é</button>

<h2>–í—Å–µ –ø–µ—Å–Ω–∏ (<span id="songCount">0</span>)</h2>
<div id="songs-list">
    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Å–µ–Ω...</p>
</div>

<script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å—Ç–∞—Ç—É—Å–∞
    function showStatus(message, type = 'success') {
        const statusEl = document.getElementById('status');
        statusEl.textContent = message;
        statusEl.className = type;
        statusEl.style.display = 'block';

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        if (type === 'success') {
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 3000);
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ HTML
    function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –ø–µ—Å–µ–Ω
    async function loadSongs() {
        try {
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Å–µ–Ω...');

            const response = await fetch('/api/songs');

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const songs = await response.json();
            console.log('–ü–æ–ª—É—á–µ–Ω–æ –ø–µ—Å–µ–Ω:', songs.length);

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
            const countEl = document.getElementById('songCount');
            if (countEl) {
                countEl.textContent = songs.length;
            } else {
                console.error('–≠–ª–µ–º–µ–Ω—Ç songCount –Ω–µ –Ω–∞–π–¥–µ–Ω!');
            }

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–µ—Å–Ω–∏
            const listEl = document.getElementById('songs-list');
            if (songs.length === 0) {
                listEl.innerHTML = '<p>–ü–µ—Å–µ–Ω –ø–æ–∫–∞ –Ω–µ—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</p>';
            } else {
                listEl.innerHTML = songs.map(song => `
                    <div class="song">
                        <h3>${escapeHtml(song.artist)} - ${escapeHtml(song.title)}</h3>
                        ${song.lyrics ? `<p><strong>–¢–µ–∫—Å—Ç:</strong></p><pre>${escapeHtml(song.lyrics)}</pre>` : ''}
                        ${song.chordsText ? `<p><strong>–ê–∫–∫–æ—Ä–¥—ã:</strong> ${escapeHtml(song.chordsText)}</p>` : ''}
                        <small>ID: ${song.id}</small>
                    </div>
                `).join('');
            }

            showStatus(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${songs.length} –ø–µ—Å–µ–Ω`, 'success');

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–µ—Å–µ–Ω:', error);
            showStatus(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`, 'error');

            const listEl = document.getElementById('songs-list');
            listEl.innerHTML = `
                <div class="error">
                    <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Å–Ω–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:</p>
                    <ol>
                        <li>–ó–∞–ø—É—â–µ–Ω–æ –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ localhost:8080</li>
                        <li>–ï—Å—Ç—å –ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É</li>
                        <li>–û—Ç–∫—Ä—ã—Ç–∞ –ª–∏ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π</li>
                    </ol>
                    <p>–û—à–∏–±–∫–∞: ${error.message}</p>
                </div>
            `;
        }
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –ø–µ—Å–Ω–∏
    async function addSong() {
        const title = document.getElementById('title').value.trim();
        const artist = document.getElementById('artist').value.trim();
        const lyrics = document.getElementById('lyrics').value.trim();
        const chords = document.getElementById('chords').value.trim();

        if (!title || !artist) {
            showStatus('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è', 'error');
            return;
        }

        const song = { title, artist, lyrics, chordsText: chords };

        try {
            console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–µ—Å–Ω–∏:', song);

            const response = await fetch('/api/songs', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json; charset=utf-8'
                },
                body: JSON.stringify(song)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const savedSong = await response.json();
            console.log('–ü–µ—Å–Ω—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞:', savedSong);

            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('title').value = '';
            document.getElementById('artist').value = '';
            document.getElementById('lyrics').value = '';
            document.getElementById('chords').value = '';

            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
            showStatus(`–ü–µ—Å–Ω—è "${escapeHtml(title)}" –¥–æ–±–∞–≤–ª–µ–Ω–∞!`, 'success');
            loadSongs();

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–µ—Å–Ω–∏:', error);
            showStatus(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
        }
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Å–Ω–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º loadSongs...');
        loadSongs();
    });

    // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
    window.loadSongs = loadSongs;
    window.addSong = addSong;

    console.log('–°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω. –§—É–Ω–∫—Ü–∏–∏ loadSongs() –∏ addSong() –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∫–æ–Ω—Å–æ–ª–∏.');
</script>
</body>
</html>